<!DOCTYPE html>
<html lang="zh-CN">
<meta charset="utf-8">
<title>HTML-456KBæ‹†åˆ†å™¨ï¼ˆé”šç‚¹åªå‡ºç°ä¸€æ¬¡ï¼Œå¯¼èˆªæœ¬ä»½æœ‰æ•ˆï¼‰</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:40px;background:#f7f7f7}
  input{font-size:18px;padding:10px}
  #links{margin-top:20px}
  a{display:inline-block;margin:4px 6px;padding:6px 12px;background:#2196F3;color:#fff;text-decoration:none;border-radius:4px}
</style>

<h2>ğŸ“ é€‰æ‹© HTML æ–‡ä»¶ â†’ æ‹†æˆ 456 KB/ä»½ï¼Œé”šç‚¹åªå†™ä¸€æ¬¡ï¼Œå¯¼èˆªä»…æœ¬ä»½æœ‰æ•ˆ</h2>
<input id="f" type="file" accept=".htm,.html">
<div id="links"></div>

<script>
const SIZE = 456 * 1024;
const letters = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p'];

document.getElementById('f').addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file)return;
  const reader = new FileReader();
  reader.onload = ()=>doSplit(file.name, reader.result);
  reader.readAsText(file, 'utf-8');
});

function doSplit(name, src){
  const linksBox = document.getElementById('links');
  linksBox.innerHTML='';

  const total = src.length;
  const step  = Math.ceil(total / 16);          // æ¯æ®µå¤§æ¦‚é•¿åº¦
  let part = 1, idx = 0, pos = 0;

  // é¢„ç”Ÿæˆ 16 æ®µå†…å®¹
  const segments = letters.map((L,i)=>{
    let s = Math.min(i*step, total);
    let e = Math.min((i+1)*step, total);
    let tagEnd = src.lastIndexOf('>', e); if(tagEnd>-1) e = tagEnd+1;
    return {L, chunk: src.slice(s,e), start:s, end:e};
  });

  while(idx < 16){
    const outLines = [];
    const push = s=>outLines.push(s);

    // å¯¼èˆªæ¡ï¼ˆæ—  hrefï¼‰
    push(`<html><META http-equiv=Content-Type content="text/html; charset=utf-8"><b><font color=green size=7><a name=0></a>`);
    letters.forEach(l=>push(`<a data-letter="${l}">${l}</a> `));
   // push(`</font></b><hr>`);

    let nowSize = new Blob(outLines,{type:'text/html;charset=gbk'}).size;
    const existInThisFile = new Set();

    // æŠŠå½“å‰æ®µåŠåç»­æ®µä¸æ–­è¿½åŠ ï¼Œç›´åˆ°å¤Ÿ 456 KB æˆ–æ²¡å†…å®¹
    while(idx < 16){
      const seg = segments[idx];
      // ç¬¬ä¸€æ¬¡å†™æœ¬æ®µæ—¶æ’å…¥é”šç‚¹
      const anchor = `<p><a name="${seg.L}"></a>ç¬¬${seg.L.toUpperCase()}ç«  <a href="#0">1</a></p>\n`;
      push(anchor + seg.chunk);
      existInThisFile.add(seg.L);
      idx++;

      nowSize = new Blob(outLines,{type:'text/html;charset=gbk'}).size;
      if(nowSize >= SIZE) break;
    }

    // ç»™å¯¼èˆªæ¡åªåŠ æœ¬ä»½å­˜åœ¨çš„ href
    let navHtml = outLines[0].replace(/<a data-letter="([a-p])">/g, (m,l)=>
      existInThisFile.has(l) ? `<a href="#${l}">` : `<a>` );
    const final = navHtml + outLines.slice(1).join('');

    const blob = new Blob([final], {type:'text/html;charset=gbk'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = name.replace(/\.htm$/i,'') + `_part_${part}.htm`;
    a.textContent = `ä¸‹è½½ ${a.download}`;
    linksBox.appendChild(a); linksBox.appendChild(document.createElement('br'));
    part++;
  }
}
</script>
